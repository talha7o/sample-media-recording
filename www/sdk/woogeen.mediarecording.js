var Woogeen=Woogeen||{};
Woogeen.EventDispatcher=function(b){var a={};b.dispatcher={};b.dispatcher.eventListeners={};a.addEventListener=function(e,a){void 0===b.dispatcher.eventListeners[e]&&(b.dispatcher.eventListeners[e]=[]);b.dispatcher.eventListeners[e].push(a)};a.removeEventListener=function(e,a){var c;c=b.dispatcher.eventListeners[e].indexOf(a);-1!==c&&b.dispatcher.eventListeners[e].splice(c,1)};a.dispatchEvent=function(a){for(var d in b.dispatcher.eventListeners[a.type])if(b.dispatcher.eventListeners[a.type].hasOwnProperty(d))b.dispatcher.eventListeners[a.type][d](a)};return a};
Woogeen.WoogeenEvent=function(b){var a={};a.type=b.type;return a};Woogeen.RoomEvent=function(b){var a=Woogeen.WoogeenEvent(b);a.streams=b.streams;return a};Woogeen.StreamEvent=function(b){var a=Woogeen.WoogeenEvent(b);a.stream=b.stream;a.msg=b.msg;return a};Woogeen.PublisherEvent=function(b){return Woogeen.WoogeenEvent(b)};Woogeen.ServerEvent=function(b){return Woogeen.WoogeenEvent(b)};Woogeen.ChatEvent=function(b){var a=Woogeen.WoogeenEvent(b);a.senderId=b.senderId;a.peerId=b.peerId;return a};
Woogeen.RecorderEvent=function(b){var a=Woogeen.WoogeenEvent(b);b.audio&&(a.audio=b.audio);b.length&&(a.length=b.length);return a};Woogeen=Woogeen||{};
Woogeen.WebAudioRecorder=function(){function b(b,a){var c;c=Speex.encodeFile(b.buffer);a(c)}var a=new Woogeen.EventDispatcher({});window.AudioContext=window.AudioContext||window.webkitAudioContext;a.compressionEnabled=!1;window.AudioContext&&(AudioContext.audiocontext||(AudioContext.audiocontext=new AudioContext),a.audiocontext=AudioContext.audiocontext);a.setIfCompress=function(b){a.compressionEnabled=b?true:false};a.record=function(b){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||
navigator.mozGetUserMedia||navigator.msGetUserMedia;var a=this;navigator.getUserMedia&&window.AudioContext&&(window.AudioContext.prototype.createJavaScriptNode||window.AudioContext.prototype.createScriptProcessor)&&window.Worker&&window.Blob?a.recorder?b&&b():navigator.getUserMedia({audio:true,video:false},function(c){a.stream=c;a.audiocontext||b&&b();a.inputsource=a.audiocontext.createMediaStreamSource(c);a.recorder=new Recorder(a.inputsource);a.recorder.record(function(){var b=Woogeen.RecorderEvent({type:"recorder-started"});
a.dispatchEvent(b)})},function(){b&&b()}):b&&b()};a.stop=function(){var a=this;if(a.recorder){a.recorder.stop();a.stream.stop();a.recorder.exportWAV(function(d){if(a.compressionEnabled)b(d,function(b){b=Woogeen.RecorderEvent({type:"recorder-stopped",audio:{data:b,type:"audio/ogg"},length:d.buffer.byteLength/22050,inputType:window.Blob.name});a.dispatchEvent(b)});else{var c=Woogeen.RecorderEvent({type:"recorder-stopped",audio:{data:d.buffer,type:"audio/wav"},length:d.buffer.byteLength/22050,inputType:window.Blob.name});
a.dispatchEvent(c)}});delete a.inputsource;delete a.recorder}};return a};Woogeen=Woogeen||{};
Woogeen.WebAudioPlayer=function(b){function a(a){a=Speex.decodeFile(a);return Speex.util.play(a[0],a[1].rate)}function e(a){for(var b=new ArrayBuffer(2*a.length),c=new Uint8Array(b),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);return b}function d(a,b){k=g.currentTime;c.source=g.createBufferSource();c.source.buffer=a;c.source.connect(g.destination);c.source.start(0,b);if(!h){var d=Woogeen.RecorderEvent({type:"player-playing"});c.dispatchEvent(d)}c.source.onended=function(){i=!1;f+=g.currentTime-k;if(f.toFixed(2)>=
c.source.buffer.duration.toFixed(2)){var a=Woogeen.RecorderEvent({type:"player-ended"});c.dispatchEvent(a);f=0;h=!1}else h||(f=0)}}window.AudioContext=window.AudioContext||window.webkitAudioContext;var c=new Woogeen.EventDispatcher({}),g=null,f=0,k=0,j,h=!1,i=!1;window.AudioContext&&(AudioContext.audiocontext||(AudioContext.audiocontext=new AudioContext),g=AudioContext.audiocontext);b&&("audio/wav"==b.type?j=b.data:"audio/ogg"==b.type&&(b=a(b.data),j=e(b)));Woogeen.WebAudioPlayer.getAudioTagSrc=function(b){if(b.type==
"audio/wav")new Blob([b.data],{type:"audio/wav"});else var b=a(b.data),c="data:audio/wav;base64,"+btoa(b);return c};c.play=function(a){if(i)a({message:"Player is playing."});else{i=true;h=false;f=0;c.audiobuffer?d(c.audiobuffer):g.decodeAudioData(j,function(a){c.audiobuffer=a;d(c.audiobuffer)},a)}};c.stop=function(){if(c.source instanceof AudioBufferSourceNode){c.source.stop();var a=Woogeen.RecorderEvent({type:"player-stopped"});c.dispatchEvent(a)}};c.pause=function(){if(c.source instanceof AudioBufferSourceNode){h=
true;c.source.stop();var a=Woogeen.RecorderEvent({type:"player-paused"});c.dispatchEvent(a)}};c.resume=function(a){if(i)a({message:"Player is playing."});else if(f==0)a({message:"Player is not paused."});else{i=true;d(c.audiobuffer,f%c.source.buffer.duration);a=Woogeen.RecorderEvent({type:"player-resume"});c.dispatchEvent(a)}};return c};new Woogeen.WebAudioPlayer;
